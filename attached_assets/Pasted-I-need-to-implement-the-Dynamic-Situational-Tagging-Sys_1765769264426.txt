I need to implement the Dynamic Situational Tagging System into the application. This involves shared logic, database updates, and UI changes in the Play Designer.

1. The Data Structure (shared/logic-dictionary.ts) We need a single source of truth for situational logic. Please export a constant SITUATIONAL_TAGS that maps Game Formats to available tags.

Structure:

TypeScript
export const SITUATIONAL_TAGS = {
  '5v5': [ ... ], // e.g., 'No Run Zone', 'Goal Line'
  '7v7': [ ... ],
  '9v9': [ ... ],
  '11v11': [ ... ]
}
Content Requirements:

5v5: 'No Run Zone (<5 yds)', 'Midfield', 'Backed Up'.

7v7: 'Red Zone (<20)', 'Goal Line (<10)', 'Open Field', 'Backed Up'.

11v11: 'Red Zone', 'Goal Line', '2-Minute', '4-Minute', 'Backed Up'.

Note: Ensure tags are distinct and football-smart as per standard coaching logic.

2. The Auto-Detection Logic (client/src/utils/format-logic.ts) Create a helper function detectGameFormat(players: Player[]): GameFormat.

Logic:

If a user explicitly selected a preset format in the UI state, return that.

Else (Implicit): Count total players (Offense + Defense).

<= 12 players → '5v5'

13-16 players → '7v7'

17-20 players → '9v9'

21+ players → '11v11'

Purpose: This will drive which tags are shown in the dropdown.

3. Database Schema Update (db/schema.ts)

Update the plays table.

Add a column: situation (text, nullable).

Migration: Provide the SQL/Drizzle push command.

4. UI Implementation (The 'Concept' Panel) Update the Right Sidebar (where we have the 'Concept' input).

Add Toggle: A checkbox labeled 'Situational Play'.

Conditional Input:

Unchecked (Default): Show the standard 'Concept' text input (or existing dropdown).

Checked: Replace the input with a Select Dropdown.

Dynamic Options: The dropdown options MUST populate based on detectGameFormat(currentPlayers). Use the map from Step 1.

5. AI Integration (server/routes.ts)

Update POST /api/generate-play.

When constructing the prompt, check if a situation tag is provided.

Context Injection: If a situation exists (e.g., 'Red Zone'), append a specific instruction: "Constraint: Design this play specifically for a [Situation] scenario. Adjust depth of routes and spacing accordingly."

Please output the full code for logic-dictionary.ts, the utility function, the schema update, and the modified Sidebar component.